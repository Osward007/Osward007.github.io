<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交互式图案</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000000;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }
        
        .container {
            position: relative;
            width: 300px;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .center-pattern {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: url('IMG_4397.png') center/cover no-repeat;
            cursor: pointer;
            position: relative;
            z-index: 10;
            transition: opacity 0.3s;
        }
        
        /* 箭头样式 - 大号红色箭头 */
        .arrow {
            position: absolute;
            width: 50px;  /* 增大 */
            height: 50px; /* 增大 */
            z-index: 5;
            opacity: 0.9;
            /* 前后移动动画 - 统一初始位置 */
            animation: move-towards-center 0.6s infinite ease-in-out;
            /* 居中定位修正 */
            transform-origin: center;
            margin-left: -25px;  /* 向左偏移一半宽度 */
            margin-top: -25px;   /* 向上偏移一半高度 */
        }
        
        .arrow svg {
            width: 100%;
            height: 100%;
        }
        
        .arrow svg path {
            stroke: #833B1A; /* 红色箭头 */
            stroke-width: 3; /* 加粗 */
        }
        
        /* 前后移动的关键帧动画 - 从同一位置开始移动 */
        @keyframes move-towards-center {
            0% {
                transform: translate(0, 0) rotate(var(--rotation));
            }
            50% {
                /* 向中心移动10像素 */
                transform: translate(
                    calc(-10px * var(--dx)),
                    calc(-10px * var(--dy))
                ) rotate(var(--rotation));
            }
            100% {
                transform: translate(0, 0) rotate(var(--rotation));
            }
        }
        
        /* 动画容器 */
        .animation-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none; /* 初始隐藏 */
            justify-content: center;
            align-items: center;
            z-index: 20;
            pointer-events: none;
        }
        
        .animation-frame {
            position: absolute;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0;
            transition: opacity 0.05s;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .container {
                width: 200px;
                height: 200px;
            }
            
            .arrow {
                width: 35px;
                height: 35px;
                margin-left: -17.5px;
                margin-top: -17.5px;
            }
        }
    </style>
</head>
<body>
    <!-- 容器确保图像在中心 -->
    <div class="container">
        <!-- 中心图案 -->
        <div class="center-pattern" id="centerPattern"></div>
    </div>
    
    <!-- 动画容器 -->
    <div class="animation-container" id="animationContainer"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.querySelector('.container');
            const centerPattern = document.getElementById('centerPattern');
            const animationContainer = document.getElementById('animationContainer');
            
            // 动画配置
            const animationConfig = {
                totalFrames: 38,  // 总共38帧 (19+19)
                fps: 30,          // 帧率 - 基础帧率
                firstGroupFrames: 19, // 第一组帧数
                secondGroupFrames: 19, // 第二组帧数
                originalSize: 2048,   // 原图尺寸
                animationSize: 3000   // 动画图尺寸
            };
            
            // 帧时间配置 - 只设置第19帧和38帧
            const frameTimingConfig = {
                19: 200,   // 第19帧(IMG_4403)显示200ms（0.2秒）
                37: 1000   // 第38帧(IMG_4420)显示1000ms（1秒）
                // 其他所有帧使用默认33.33ms
            };
            
            // 计算缩放比例和基础帧间隔
            const scaleRatio = animationConfig.animationSize / animationConfig.originalSize;
            const baseFrameInterval = 1000 / animationConfig.fps; // 默认33.33ms
            
            // 预加载所有动画帧 - 使用您指定的图片名称
            function preloadAnimationFrames() {
                const frames = [];
                const promises = [];
                
                console.log('开始预加载动画帧...');
                
                // 第一组：mimo0001至mimo0019
                for (let i = 1; i <= 19; i++) {
                    const frameNum = i.toString().padStart(4, '0');
                    const img = new Image();
                    img.src = `mimo${frameNum}.png`;  // 您的图片名称：mimo0001.png 到 mimo0019.png
                    frames.push(img);
                    console.log(`加载: mimo${frameNum}.png`);
                    
                    promises.push(new Promise((resolve, reject) => {
                        img.onload = resolve;
                        img.onerror = () => reject(`无法加载: mimo${frameNum}.png`);
                    }));
                }
                
                // 第二组：IMG_4403至IMG_4420
                for (let i = 3; i <= 20; i++) {
                    const frameNum = i.toString().padStart(2, '0');
                    const img = new Image();
                    img.src = `IMG_44${frameNum}.png`;  // 您的图片名称：IMG_4403.png 到 IMG_4420.png
                    frames.push(img);
                    console.log(`加载: IMG_44${frameNum}.png`);
                    
                    promises.push(new Promise((resolve, reject) => {
                        img.onload = resolve;
                        img.onerror = () => reject(`无法加载: IMG_44${frameNum}.png`);
                    }));
                }
                
                return { frames, promises };
            }
            
            // 创建箭头
            function createArrows() {
                const containerRect = container.getBoundingClientRect();
                const arrowCount = 12;
                const centerX = containerRect.left + containerRect.width / 2;
                const centerY = containerRect.top + containerRect.height / 2;
                const patternRadius = containerRect.width / 2;
                
                document.querySelectorAll('.arrow').forEach(arrow => arrow.remove());
                
                for (let i = 0; i < arrowCount; i++) {
                    const angle = (i / arrowCount) * Math.PI * 2;
                    const dx = Math.cos(angle);
                    const dy = Math.sin(angle);
                    
                    const distanceFromCenter = patternRadius * 0.95;
                    const x = centerX + distanceFromCenter * dx;
                    const y = centerY + distanceFromCenter * dy;
                    
                    const arrow = document.createElement('div');
                    arrow.className = 'arrow';
                    arrow.style.position = 'fixed';
                    arrow.style.left = `${x}px`;
                    arrow.style.top = `${y}px`;
                    
                    const rotation = Math.atan2(centerY - y, centerX - x) * (180 / Math.PI);
                    arrow.style.setProperty('--rotation', `${rotation}deg`);
                    arrow.style.setProperty('--dx', dx);
                    arrow.style.setProperty('--dy', dy);
                    arrow.style.animationDelay = '0s';
                    
                    arrow.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    `;
                    
                    document.body.appendChild(arrow);
                }
            }
            
            // 播放动画序列
            function playAnimationSequence(frames) {
                console.log('开始播放动画序列...');
                console.log('第20帧: 200ms, 第38帧: 1000ms');
                
                const containerRect = container.getBoundingClientRect();
                
                // 立即隐藏原始图案
                centerPattern.style.opacity = '0';
                centerPattern.style.pointerEvents = 'none';
                
                // 显示动画容器
                animationContainer.style.display = 'flex';
                
                let currentFrame = 0;
                const totalFrames = frames.length;
                
                function showFrame() {
                    // 清除之前的帧
                    animationContainer.innerHTML = '';
                    
                    if (currentFrame >= totalFrames) {
                        console.log('动画播放完毕');
                        return;
                    }
                    
                    // 创建当前帧
                    const frameElement = document.createElement('div');
                    frameElement.className = 'animation-frame';
                    frameElement.style.width = `${containerRect.width}px`;
                    frameElement.style.height = `${containerRect.height}px`;
                    frameElement.style.backgroundImage = `url('${frames[currentFrame].src}')`;
                    frameElement.style.transform = `scale(${scaleRatio})`;
                    frameElement.style.opacity = '1';
                    
                    animationContainer.appendChild(frameElement);
                    
                    // 确定当前帧的显示时间
                    let frameInterval = baseFrameInterval; // 默认33.33ms
                    
                    // 检查是否有自定义的帧时间
                    if (frameTimingConfig[currentFrame] !== undefined) {
                        frameInterval = frameTimingConfig[currentFrame];
                        console.log(`第${currentFrame + 1}帧使用自定义时间: ${frameInterval}ms`);
                    }
                    
                    currentFrame++;
                    setTimeout(showFrame, frameInterval);
                }
                
                // 开始播放
                showFrame();
            }
            
            // 预加载动画帧
            const { frames, promises } = preloadAnimationFrames();
            let allFramesLoaded = false;
            
            // 等待所有图片加载完成
            Promise.all(promises)
                .then(() => {
                    allFramesLoaded = true;
                    console.log('✓ 所有动画帧加载完成');
                })
                .catch((error) => {
                    console.error('✗ 图片加载失败:', error);
                    alert(`图片加载失败: ${error}\n请检查图片文件是否存在`);
                });
            
            // 创建箭头
            createArrows();
            
            // 点击事件
            let isClicked = false;
            centerPattern.addEventListener('click', function() {
                if (!isClicked) {
                    console.log('点击触发动画播放');
                    
                    // 隐藏所有箭头
                    const arrows = document.querySelectorAll('.arrow');
                    arrows.forEach(arrow => {
                        arrow.style.transition = 'opacity 0.3s, transform 0.3s';
                        arrow.style.opacity = '0';
                        arrow.style.transform = 'scale(0.5)';
                        setTimeout(() => {
                            arrow.style.display = 'none';
                        }, 300);
                    });
                    
                    // 播放动画
                    if (allFramesLoaded) {
                        playAnimationSequence(frames);
                    } else {
                        console.log('动画帧还未加载完成，等待中...');
                        
                        // 显示加载提示
                        const loadingMsg = document.createElement('div');
                        loadingMsg.textContent = '加载动画中...';
                        loadingMsg.style.color = 'white';
                        loadingMsg.style.position = 'fixed';
                        loadingMsg.style.top = '50%';
                        loadingMsg.style.left = '50%';
                        loadingMsg.style.transform = 'translate(-50%, -50%)';
                        loadingMsg.style.zIndex = '30';
                        loadingMsg.style.fontSize = '20px';
                        loadingMsg.style.background = 'rgba(0,0,0,0.8)';
                        loadingMsg.style.padding = '20px';
                        loadingMsg.style.borderRadius = '10px';
                        document.body.appendChild(loadingMsg);
                        
                        // 等待加载完成
                        const checkInterval = setInterval(() => {
                            if (allFramesLoaded) {
                                clearInterval(checkInterval);
                                loadingMsg.remove();
                                playAnimationSequence(frames);
                            }
                        }, 100);
                    }
                    
                    isClicked = true;
                }
            });
            
            // 窗口大小改变时重新创建箭头
            window.addEventListener('resize', function() {
                createArrows();
            });
        });
    </script>
</body>
</html>